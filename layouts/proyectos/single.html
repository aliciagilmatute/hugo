{{ define "head" }}
<meta name="description" content="{{ .Params.description }}">
<link rel="stylesheet" href="{{.Site.Params.staticPath}}/css/single.css">

<!-- fontawesome -->
<script defer src="{{.Site.Params.staticPath}}/fontawesome-6/all-6.4.2.js"></script>

<!-- Estilos del botón Volver a Proyectos y extras -->
<style>
  .btn-contact {
    transition: none;
    transition: opacity 0.3s;
    border-radius: .5rem !important;
    border: 1px solid var(--primary-color) !important;
    background-color: var(--secondary-color) !important;
    color: var(--text-color) !important;
    display: inline-block;
    padding: 0.5rem 1rem;
    text-decoration: none;
    font-weight: 500;
  }
  .btn-contact:hover { opacity: 0.7; }
  .btn-contact:focus { box-shadow: none !important; outline: none; }

  /* Copy button */
  .copy-btn {
    font-family: "Inter", Arial, sans-serif;
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    padding: 0.025rem 0.6rem;
    font-size: 0.75rem;
    border-radius: 0.5rem;
    background-color: var(--primary-color);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.2);
    cursor: pointer;
    transition: background-color 0.2s;
  }
  .copy-btn:hover { background-color: #5BB8CC; }
  body.dark .copy-btn { background-color: rgba(255,255,255,0.05); color: white; }
  body.dark .copy-btn:hover { background-color: #ccc; }

/* Contenedor de código con botón */
.code-container {
  position: relative; /* NECESARIO para que el botón se posicione */
}

/* Bloques de código siempre en negro */
.code-container pre,
.code-container pre code {
  color: black !important;
  background-color: rgba(255,255,255,0.05);
  font-family: monospace;
}

/* Evitar colores de resaltado de sintaxis */
.code-container pre code span {
  color: var(--text-color) !important;
  background: none !important;
}

  /* Materiales */
  .materiales { text-align: left; margin: 2rem 0 1rem; font-size: 1rem; color: var(--text-color); }
  .materiales strong { display: block; margin-bottom: 0.75rem; }
  .materiales-botones { display: flex; gap: 0.75rem; }
  .materiales-botones a {
    display: inline-flex; align-items: center; justify-content: center;
    width: 48px; height: 48px;
    background-color: var(--primary-color);
    border-radius: 0.5rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.15);
    transition: background-color 0.2s ease, transform 0.1s ease;
  }
  .materiales-botones a:hover { background-color: #5BB8CC; transform: translateY(-2px); }
  .materiales-botones svg { width: 24px; height: 24px; fill: white; }
  body.dark .materiales-botones a { background-color: var(--primary-color-dark); }
  body.dark .materiales-botones a:hover { background-color: #ccc; }
  body.dark .materiales-botones svg { fill: var(--background-color-dark); }

  /* Tableau Section */
  .tableau-section { text-align: center; margin: 3rem 0; }
  .tableau-container {
    position: relative;
    width: 100%;
    padding-bottom: 65%; /* proporción 16:10 */
    height: 0;
    overflow: hidden;
    border-radius: none;
    box-shadow: none;
  }
  .tableau-container iframe {
    position: absolute;
    top: 0; left: 0;
    width: 150%; height: 150%;
    transform: scale(0.75); /* 0.8 = 80% del tamaño original */
    transform-origin: top left;
    border: none;
  }

/* Separación extra en móviles */
@media (max-width: 767px) {
  .btn-contact {
    margin-bottom: 2rem; /* da espacio antes de que aparezca la TOC */
  }

  .toc {
    margin-top: 2rem; /* por si quieres más aire entre el botón y la tabla */
  }
}

</style>
{{ end }}

{{ define "title" }}
{{.Title }} | {{ .Site.Title }}
{{ end }}

{{ define "main" }}
<section id="single">
  <div class="container">
    <div class="row justify-content-center">
      <!-- Contenido principal -->
      <div class="col-sm-12 col-md-12 col-lg-9">
        <div class="pr-lg-4">
          <!-- Imagen -->
          {{ with .Params.image }}
          <div class="text-center mb-4">
            <img src="{{ . }}" alt="{{ $.Title }}" style="max-width:150px; margin-bottom:1rem;">
          </div>
          {{ end }}

          <!-- Título -->
          <div class="title mb-5">
            <h1 class="project-title text-center mb-4">{{ .Title }}</h1>
            <div class="text-center">
              {{ if .Params.author }}{{ .Params.author }} <small>|</small>{{ end }}
              {{ .Date.Format (.Site.Params.datesFormat.article | default "Jan 20, 20") }}
              {{ if or (.Site.Params.singlePages.readTime.enable | default true) (.Params.enableReadingTime) }}
              <!-- <span id="readingTime">{{ .Site.Params.singlePages.readTime.content | default "min read" }}</span> -->
              {{ end }}
            </div>
          </div>

          <!-- Descripción -->
          {{ with .Params.description }}
            <p class="project-description text-center">{{ . }}</p>
            
          {{ end }}

          <!-- Badges -->
          <div class="text-center mb-3">
            {{ range .Params.badges }}
              <span class="badge-project">{{ . }}</span>
            {{ end }}
          </div>
          
          <!-- Materiales -->
          <div class="materiales">
            <strong>Repositorios:</strong>
            <div class="materiales-botones">
              {{ with .Params.github }}
                <a href="{{ . }}" target="_blank" aria-label="GitHub">
                  <svg role="img" viewBox="0 0 24 24">
                    <path d="M12 .297c-6.63 0-12 5.373-12 12 
                             0 5.303 3.438 9.8 8.205 11.387
                             .6.113.82-.258.82-.577
                             0-.285-.01-1.04-.015-2.04
                             -3.338.724-4.042-1.61-4.042-1.61
                             -.546-1.387-1.333-1.757-1.333-1.757
                             -1.09-.745.083-.729.083-.729
                             1.205.084 1.84 1.237 1.84 1.237
                             1.07 1.835 2.807 1.304 3.492.997
                             .108-.775.418-1.305.762-1.605
                             -2.665-.3-5.466-1.332-5.466-5.93
                             0-1.31.467-2.38 1.235-3.22
                             -.123-.303-.535-1.523.117-3.176
                             0 0 1.008-.322 3.301 1.23
                             a11.5 11.5 0 0 1 3.003-.404
                             11.48 11.48 0 0 1 3.003.404
                             c2.293-1.552 3.3-1.23 3.3-1.23
                             .653 1.653.241 2.873.118 3.176
                             .77.84 1.233 1.91 1.233 3.22
                             0 4.61-2.803 5.628-5.475 5.922
                             .43.372.823 1.102.823 2.222
                             0 1.606-.014 2.898-.014 3.293
                             0 .319.218.694.825.576
                             C20.565 22.092 24 17.592 24 12.297
                             c0-6.627-5.373-12-12-12"/>
                  </svg>
                </a>
              {{ end }}

              {{ with .Params.kaggle }}
                <a href="{{ . }}" target="_blank" aria-label="Kaggle">
                  <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18.825 23.859c-.022.092-.117.141-.281.141h-3.139
                             c-.187 0-.351-.082-.492-.248l-5.178-6.589-1.448 1.374v5.111
                             c0 .235-.117.352-.351.352H5.505
                             c-.236 0-.354-.117-.354-.352V.353
                             c0-.233.118-.353.354-.353h2.431
                             c.234 0 .351.12.351.353v14.343l6.203-6.272
                             c.165-.165.33-.246.495-.246h3.239
                             c.144 0 .236.06.285.18.046.149.034.255-.036.315
                             l-6.555 6.344 6.836 8.507c.095.104.117.208.07.358"/>
                  </svg>
                </a>
              {{ end }}
            </div>
          </div>



          <!-- Contenido -->
          <article class="page-content p- project-content">
            {{ .Content | emojify }}
          </article>

          <!-- Dashboard Tableau -->
          {{ with .Params.tableau }}
          <div class="tableau-section">
            <h2 class="mb-4"></h2>
            <div class="tableau-container">
              <iframe src="{{ . }}" allowfullscreen></iframe>
            </div>
          </div>
          {{ end }}

          <!-- Botón volver -->
          <div class="text-center mt-4">
            <a href="/proyectos" class="btn-contact">Volver a Proyectos</a>
          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="col-sm-12 col-md-12 col-lg-3">
        <div id="stickySideBar" class="sticky-sidebar">
          {{ if .Params.toc | default true}}
          <aside class="toc">
              <h5>{{ .Site.Params.terms.toc | default "Tabla de Contenidos" }}</h5>
              <div class="toc-content">{{.TableOfContents}}</div>
          </aside>
          {{ end }}

          {{ if .Params.tags }}
          <aside class="tags">
            <h5>{{ .Site.Params.terms.tags | default "Tags" }}</h5>
            <ul class="tags-ul list-unstyled list-inline">
              {{range .Params.tags}}
              <li class="list-inline-item"><a href="{{`tags` | absURL}}/{{.| urlize}}" {{ if site.Params.singlePages.tags.openInNewTab | default true }}target="_blank"{{ end }}>{{.}}</a></li>
              {{end}}
            </ul>
          </aside>
          {{end}}

          {{ if .Params.socialShare | default .Site.Params.singlePages.socialShare | default true }}
          <aside class="social">
            <h5>{{ .Site.Params.terms.social | default "Social" }}</h5>
            <div class="social-content">
              <ul class="list-inline">
                <li class="list-inline-item text-center"><a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url={{ .Site.Params.hostName }}{{ .Permalink | absURL }}"><i class="fab fa-linkedin"></i></a></li>
                <li class="list-inline-item text-center"><a target="_blank" href="https://twitter.com/share?text={{ .Title }}&url={{ .Site.Params.hostName }}{{ .Permalink | absURL }}"><i class="fab fa-twitter"></i></a></li>
                <li class="list-inline-item text-center"><a target="_blank" href="https://api.whatsapp.com/send?text={{ .Title }}: {{ .Site.Params.hostName }}{{ .Permalink | absURL }}"><i class="fab fa-whatsapp"></i></a></li>
                <li class="list-inline-item text-center"><a target="_blank" href='mailto:?subject={{ .Title }}&amp;body={{ .Site.Params.terms.emailText | default "Check out this site" }} {{ .Site.Params.hostName }}{{ .Permalink | absURL }}'><i class="fa fa-envelope"></i></a></li>
              </ul>
            </div>
          </aside>
          {{ end }}
        </div>
      </div>
    </div>

  <!-- Scroll top -->
  <button class="p-2 px-3" onclick="topFunction()" id="topScroll"><i class="fas fa-angle-up"></i></button>
</section>

<!-- Barra de progreso -->
{{ if or (.Site.Params.singlePages.scrollprogress.enable | default true) (.Params.enableScrollProgress) }}
<div class="progress"><div id="scroll-progress-bar" class="progress-bar" role="progressbar"></div></div>
<script src="{{.Site.Params.staticPath}}/js/scrollProgressBar.js"></script>
{{ end }}

<!-- Scripts -->
<script>
  var topScroll = document.getElementById("topScroll");
  window.onscroll = function() {scrollFunction()};
  function scrollFunction() {
    if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) { topScroll.style.display = "block"; }
    else { topScroll.style.display = "none"; }
  }
  function topFunction() { document.body.scrollTop = 0; document.documentElement.scrollTop = 0; }

  // Sticky sidebar height
  let stickySideBarElem = document.getElementById("stickySideBar");
  let stickyNavBar = {{ .Site.Params.navbar.stickyNavBar.enable | default false }};
  if(stickyNavBar) {
    let headerElem = document.getElementById("profileHeader");
    let headerHeight = headerElem.offsetHeight + 15;
    stickySideBarElem.style.top = headerHeight + "px";
  } else {
    stickySideBarElem.style.top = "50px";
  }
</script>

<!-- Tiempo de lectura -->
{{ if or (.Site.Params.singlePages.readTime.enable | default true) (.Params.enableReadingTime) }}
<script src="{{.Site.Params.staticPath}}/js/readingTime.js"></script>
{{end}}

<!-- Script botones Copy -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll("pre > code").forEach((codeBlock) => {
      const pre = codeBlock.parentNode;
      const container = document.createElement("div");
      container.classList.add("code-container");
      pre.parentNode.insertBefore(container, pre);
      container.appendChild(pre);
      const button = document.createElement("button");
      button.className = "copy-btn"; button.textContent = "Copy";
      button.addEventListener("click", () => {
        navigator.clipboard.writeText(codeBlock.innerText).then(() => {
          button.textContent = "Copied!"; setTimeout(() => (button.textContent = "Copy"), 2000);
        });
      });
      container.appendChild(button);
    });
  });
</script>

<footer class="py-4 text-center">
  <p>&copy; 2025 Alicia Gil Matute</p>
</footer>
{{ end }}
